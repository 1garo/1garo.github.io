<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Why you should use zod as your validator? | 1garo's blog</title>
<link rel=stylesheet href=/assets/combined.min.e962532feeb5740101e74674a3b76810a4b11df3e73378622fd233e3e9f06c82.css media=all><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\[","\\]"],["$","$"]]}}</script></head><body class=light><div class=content><header><div class=header><h1 class=header-title>1garo's blog</h1><div class=flex><p class=small><a href=/>/home</a></p><p class=small><a href=/posts>/posts</a></p><p class=small><a href=/carrer>/resume</a></p></div></div></header><main class=main><div><div class=single-intro-container><h1 class=single-title>Why you should use zod as your validator?</h1><p class=single-readtime><time datetime=2023-03-07T16:00:00-03:00>March 7, 2023</time>
-
3 min</p></div><aside class=toc><p><strong>Table of contents</strong></p><nav id=TableOfContents><ul><li><a href=#installation>Installation</a></li><li><a href=#practical-examples>Practical examples</a></li><li><a href=#let-me-show-you-the-zod-way>Let me show you the <code>zod</code> way!</a></li></ul></nav></aside><div class=single-content><h1 id=why-you-should-use-zod-as-your-validator>Why you should use zod as your validator?</h1><p>The title is just to bring some attention&mldr; I know, you use what you want,
but today I&rsquo;ll be giving some insights on zod, from someone that is using it daily for the last 6-8 months.</p><p>To keep it simple, I&rsquo;m gonna omit most of the <code>express</code>
app setup because it&rsquo;s kinda easy to do, however you can find it in their <a href=https://github.com/expressjs/express>documentation</a>.</p><hr><h2 id=installation>Installation</h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm i zod express typescript body-parser
</span></span><span style=display:flex><span>$ npm i -g npx
</span></span><span style=display:flex><span>$ npx tsc --init
</span></span><span style=display:flex><span>$ npm i --save-dev @types/express
</span></span></code></pre></div><h2 id=practical-examples>Practical examples</h2><p>Let&rsquo;s say that you have an <code>express</code> api with a <code>/user</code> endpoint.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#888;font-style:italic>// src/index.ts
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span><span style=font-weight:700;text-decoration:underline>import</span> express, { Express } <span style=font-weight:700;text-decoration:underline>from</span> <span style=color:#666;font-style:italic>&#39;express&#39;</span>;
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>import</span> bodyParser <span style=font-weight:700;text-decoration:underline>from</span> <span style=color:#666;font-style:italic>&#39;body-parser&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>import</span> User <span style=font-weight:700;text-decoration:underline>from</span> <span style=color:#666;font-style:italic>&#39;./controller/user.controller&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>const</span> app: <span style=font-weight:700;text-decoration:underline>Express</span> = express();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>// parse application/json
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>app.use(bodyParser.json())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.post(<span style=color:#666;font-style:italic>&#39;/user&#39;</span>, User.create);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.listen(3000, () =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#666;font-style:italic>`⚡️[server]: Server is running at http://localhost:</span><span style=color:#666;font-style:italic>${</span>3000<span style=color:#666;font-style:italic>}</span><span style=color:#666;font-style:italic>`</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>You usually would do something like:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#888;font-style:italic>// controller/user.controller.ts
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span><span style=font-weight:700;text-decoration:underline>import</span> { Request, Response } <span style=font-weight:700;text-decoration:underline>from</span> <span style=color:#666;font-style:italic>&#39;express&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>const</span> User = (() =&gt; {
</span></span><span style=display:flex><span>    <span style=font-weight:700;text-decoration:underline>const</span> create = <span style=font-weight:700;text-decoration:underline>async</span> (req: <span style=font-weight:700;text-decoration:underline>Request</span>, res: <span style=font-weight:700;text-decoration:underline>Response</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=font-weight:700;text-decoration:underline>const</span> { name, age } = req.body;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#888;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>
</span></span><span style=display:flex><span>        <span style=font-weight:700;text-decoration:underline>return</span> res.send({ name, age })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=font-weight:700;text-decoration:underline>return</span> {
</span></span><span style=display:flex><span>        create,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>})();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>export</span> <span style=font-weight:700;text-decoration:underline>default</span> User;
</span></span></code></pre></div><p>But as we can see,
we lack typing inference, type validation, and a lot of other things.</p><p>Also you could say something like:</p><blockquote><p><strong>1garo, you are wrong, I know better!.</strong></p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#888;font-style:italic>// controller/user.controller.ts
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>import</span> { CreateUser } <span style=font-weight:700;text-decoration:underline>from</span> <span>&#39;@</span>/types/user.typings
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>/// ...
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span><span style=font-weight:700;text-decoration:underline>const</span> { name, age } = req.body <span style=font-weight:700;text-decoration:underline>as</span> CreateUser;
</span></span></code></pre></div><p>Well, you are right! Kinda&mldr;</p><p>I just don&rsquo;t wanna be there when the <strong>user</strong> sends something wrong (and he WILL! I ensure you of that).</p><h2 id=let-me-show-you-the-zod-way>Let me show you the <code>zod</code> way!</h2><p>One of the things that I really like about <code>zod</code> is this &ldquo;composition&rdquo; approach. It
makes me feel that I&rsquo;m writing in a functional language and it&rsquo;s very easy to use,
so let&rsquo;s solve the problem that we had discussed.</p><p>We have to describe our schema, the one to be validated.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#888;font-style:italic>// src/validation/user.validation.ts
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span><span style=font-weight:700;text-decoration:underline>import</span> z <span style=font-weight:700;text-decoration:underline>from</span> <span style=color:#666;font-style:italic>&#39;zod&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>export</span> <span style=font-weight:700;text-decoration:underline>const</span> userValidation = z.<span style=font-weight:700;text-decoration:underline>object</span>({
</span></span><span style=display:flex><span>  name:
</span></span><span style=display:flex><span>  <span style=font-weight:700;text-decoration:underline>z.string</span>()
</span></span><span style=display:flex><span>    .min(1, { message: <span style=color:#666;font-style:italic>&#34;Must be 1 or more characters long&#34;</span> })
</span></span><span style=display:flex><span>    .trim(),
</span></span><span style=display:flex><span>  age:
</span></span><span style=display:flex><span>  <span style=font-weight:700;text-decoration:underline>z.number</span>()
</span></span><span style=display:flex><span>    .gte(18)
</span></span><span style=display:flex><span>    .int()
</span></span><span style=display:flex><span>    .positive()
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>Now back to the last example and let&rsquo;s use our new validator.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span>- <span style=font-weight:700;text-decoration:underline>const</span> { name, age } = req.body <span style=font-weight:700;text-decoration:underline>as</span> CreateUser;
</span></span><span style=display:flex><span>+ <span style=font-weight:700;text-decoration:underline>const</span> { name, age } = <span style=font-weight:700;text-decoration:underline>await</span> userValidation.parse(req.body);
</span></span></code></pre></div><p>Yeahhhh, We did it! Now your input is type safe and has inference.</p><hr><p>I just showed you a tiny bit about what <code>zod</code> can do, but you can check it out more
<a href=https://github.com/colinhacks/zod#basic-usage target=_blank>here</a>.</p><p>My favorite functionalities are: <code>.refine()</code>, <code>.transform()</code>, and <code>.partial()</code>.
Maybe I could write another post using those features, I think it could be fun!</p><p>See u on the next episode.</p></div></div></main></div><footer><p>Powered by
<a href=https://gohugo.io/>Hugo</a>
and
<a href=https://github.com/tomfran/typo>tomfran/typo</a></p></footer></body><script>function isAuto(){return document.body.classList.contains("auto")}function setTheme(){if(!isAuto())return;console,document.body.classList.remove("auto");let e="light";console.log,window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(e="dark"),document.body.classList.add(e)}function invert(){document.body.classList.toggle("dark"),document.body.classList.toggle("light")}isAuto()&&(console.log("Setting invert listener"),window.matchMedia("(prefers-color-scheme: dark)").addListener(invert)),setTheme()</script></html>