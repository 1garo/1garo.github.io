<!doctype html><html lang=en-us><head><title>1garo</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content><link rel=stylesheet href=../../css/theme.min.css></head><body><div id=content class=mx-auto><header class="container mt-sm-5 mt-4 mb-4 mt-xs-1"><div class=row><div class="col-sm-4 col-12 text-sm-right text-center pt-sm-4"><a href=../../ class=text-decoration-none><img id=home-image class=rounded-circle src=../../images/1548447057111.jpeg></a></div><div class="col-sm-8 col-12 text-sm-left text-center"><h2 class="m-0 mb-2 mt-4"><a href=../../ class=text-decoration-none>1garo's blog</a></h2><p class="text-muted mb-1">Writing my thoughts out loud</p><ul id=nav-links class="list-inline mb-2"><li class=list-inline-item><a class="badge badge-white" href=../../carrer/ title=Carrer>Carrer</a></li><li class=list-inline-item><a class="badge badge-white" href=../../posts/ title=Posts>Posts</a></li><li class=list-inline-item><a class="badge badge-white" href=../../categories/ title=Categories>Categories</a></li></ul><ul id=nav-social class=list-inline><li class="list-inline-item mr-3"><a href=http://github.com/1garo target=_blank><i class="fab fa-github fa-1x text-muted"></i></a></li><li class="list-inline-item mr-3"><a href=https://www.linkedin.com/in/alevardai target=_blank><i class="fab fa-linkedin-in fa-1x text-muted"></i></a></li><li class="list-inline-item mr-3"><a href=https://twitter.com/1gar_o target=_blank><i class="fab fa-twitter fa-1x text-muted"></i></a></li></ul></div></div><hr></header><div class=container><div class="pl-sm-4 ml-sm-5"><p>The title is just to bring some attention&mldr; I know, you use what you want,
but today I&rsquo;ll be giving some insights on zod, from someone that is using it daily for the last 6-8 months.</p><p>To keep it simple, I&rsquo;m gonna omit most of the <code>express</code>
app setup because it&rsquo;s kinda easy to do, however you can find it in their <a href=https://github.com/expressjs/express>documentation</a>.</p><h2 id=installation>Installation</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm i zod express typescript body-parser
</span></span><span style=display:flex><span>$ npm i -g npx
</span></span><span style=display:flex><span>$ npx tsc --init
</span></span><span style=display:flex><span>$ npm i --save-dev @types/express
</span></span></code></pre></div><p>Let&rsquo;s say that you have an <code>express</code> api with a <code>/user</code> endpoint.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#b0bec5>// src/index.ts
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>import</span> express, { Express } <span style=color:#c2ffdf>from</span> <span style=color:#1bc5e0>&#39;express&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#c2ffdf>import</span> bodyParser <span style=color:#c2ffdf>from</span> <span style=color:#1bc5e0>&#39;body-parser&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c2ffdf>import</span> User <span style=color:#c2ffdf>from</span> <span style=color:#1bc5e0>&#39;./controller/user.controller&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c2ffdf>const</span> app: <span style=color:#c2ffdf>Express</span> <span style=color:#ffb8d1>=</span> express();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b0bec5>// parse application/json
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span>app.use(bodyParser.json())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.post(<span style=color:#1bc5e0>&#39;/user&#39;</span>, User.create);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.listen(<span style=color:#c5a3ff>3000</span>, () <span style=color:#ffb8d1>=&gt;</span> {
</span></span><span style=display:flex><span>  console.log(<span style=color:#1bc5e0>`⚡️[server]: Server is running at http://localhost:</span><span style=color:#1bc5e0>${</span><span style=color:#c5a3ff>3000</span><span style=color:#1bc5e0>}</span><span style=color:#1bc5e0>`</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>You usually would do something like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#b0bec5>// controller/user.controller.ts
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>import</span> { Request, Response } <span style=color:#c2ffdf>from</span> <span style=color:#1bc5e0>&#39;express&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c2ffdf>const</span> User <span style=color:#ffb8d1>=</span> (() <span style=color:#ffb8d1>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#c2ffdf>const</span> create <span style=color:#ffb8d1>=</span> <span style=color:#c2ffdf>async</span> (req: <span style=color:#c2ffdf>Request</span>, res: <span style=color:#c2ffdf>Response</span>) <span style=color:#ffb8d1>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#c2ffdf>const</span> { name, age } <span style=color:#ffb8d1>=</span> req.body;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#b0bec5>// ...
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span>
</span></span><span style=display:flex><span>        <span style=color:#c2ffdf>return</span> res.send({ name, age })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c2ffdf>return</span> {
</span></span><span style=display:flex><span>        create,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>})();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c2ffdf>export</span> <span style=color:#c2ffdf>default</span> User;
</span></span></code></pre></div><p>But as we can see,
we lack typing inference, type validation, and a lot of other things.</p><p>Also you could say something like:</p><blockquote><p><em>1garo</em>, you are wrong, I know better!.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#b0bec5>// controller/user.controller.ts
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span>
</span></span><span style=display:flex><span><span style=color:#c2ffdf>import</span> { CreateUser } <span style=color:#c2ffdf>from</span> <span style=color:#960050;background-color:#1e0010>&#39;@</span><span style=color:#ffb8d1>/</span>types<span style=color:#ffb8d1>/</span>user.typings
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b0bec5>/// ...
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>const</span> { name, age } <span style=color:#ffb8d1>=</span> req.body <span style=color:#c2ffdf>as</span> CreateUser;
</span></span></code></pre></div><p>Well, you are right! Kinda&mldr;</p><p>I just don&rsquo;t wanna be there when the <strong>user</strong> sends something wrong (and he WILL! I ensure you of that).</p><h2 id=let-me-show-you-the-zod-way>Let me show you the <code>zod</code> way!</h2><p>One of the things that I really like about <code>zod</code> is this &ldquo;composition&rdquo; approach. It
makes me feel that I&rsquo;m writing in a functional language and it&rsquo;s very easy to use,
so let&rsquo;s solve the problem that we had discussed.</p><p>We have to describe our schema, the one to be validated.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#b0bec5>// src/validation/user.validation.ts
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>import</span> z <span style=color:#c2ffdf>from</span> <span style=color:#1bc5e0>&#39;zod&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c2ffdf>export</span> <span style=color:#c2ffdf>const</span> userValidation <span style=color:#ffb8d1>=</span> z.<span style=color:#c2ffdf>object</span>({
</span></span><span style=display:flex><span>  name:
</span></span><span style=display:flex><span>  <span style=color:#c2ffdf>z.string</span>()
</span></span><span style=display:flex><span>    .min(<span style=color:#c5a3ff>1</span>, { message<span style=color:#ffb8d1>:</span> <span style=color:#1bc5e0>&#34;Must be 1 or more characters long&#34;</span> })
</span></span><span style=display:flex><span>    .trim(),
</span></span><span style=display:flex><span>  age:
</span></span><span style=display:flex><span>  <span style=color:#c2ffdf>z.number</span>()
</span></span><span style=display:flex><span>    .gte(<span style=color:#c5a3ff>18</span>)
</span></span><span style=display:flex><span>    .int()
</span></span><span style=display:flex><span>    .positive()
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>Now back to the last example and let&rsquo;s use our new validator.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#ffb8d1>-</span> <span style=color:#c2ffdf>const</span> { name, age } <span style=color:#ffb8d1>=</span> req.body <span style=color:#c2ffdf>as</span> CreateUser;
</span></span><span style=display:flex><span><span style=color:#ffb8d1>+</span> <span style=color:#c2ffdf>const</span> { name, age } <span style=color:#ffb8d1>=</span> <span style=color:#c2ffdf>await</span> userValidation.parse(req.body);
</span></span></code></pre></div><p>Yeahhhh, We did it! Now your input is type safe and has inference.</p><p>I just showed you a tiny bit about what <code>zod</code> can do, but you can check it out more
<a href=https://github.com/colinhacks/zod#basic-usage target=_blank>here</a>.</p><p>My favorite functionalities are: <code>.refine()</code>, <code>.transform()</code>, and <code>.partial()</code>.
Maybe I could write another post using those features, I think it could be fun!</p><p>See u on the next episode.</p></div></div></div><footer class="text-center pb-1"><small class=text-muted>&copy; 2023, Alexandre Vardai<br>Powered by <a href=https://gohugo.io/ target=_blank>Hugo</a>
and <a href=https://github.com/austingebauer/devise target=_blank>Devise</a></small></footer></body></html>